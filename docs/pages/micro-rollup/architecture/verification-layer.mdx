# Verification Layer [aka Vulcan]

The Stackr verification layer, also known as "Vulcan" is responsible for
- **Verification**: Check correctness of state transitions
- **Fast finality**: Provide soft confirmations to microrollups (also known as C2 confirmation)
- **Settlement**: Provide data availability and hard confirmations to microrollups (also known as C3 confirmation)
- **Bridging** (Coming soon): Provide fast and secure message passing between microrollups

Therefore, Vulcan provides a flexible range of settlement-as-a-service options for micro-rollups and lets developers focus on their core business logic.

## Verification

<img src="/assets/deploy.png" alt="Verification Model" />

The developer builds out their Stackr State machine (SSM) and deploys it as a microrollup (execution layer).
The SSM is then compiled down to a WASM binary and sent to Vulcan, alongwith an initial genesis state. This happens during the `deploy` CLI command. In the future, Vulcan will post it on a DA layer to ensure full availability. 
After deployment, MRUs send batches at a developer-set cadence to Vulcan which then verifies the state transitions in each of the batches while ensuring consecutive block height ordering.

### Pessimistic re-execution

Vulcan employs a pessimistic re-execution model to verify the incoming blocks from micro-rollups. 
The blocks from the execution layer are sent to Vulcan periodically. Vulcan uses the application’s WASM binary and applies the actions inside the block one-by-one on the genesis to generate the new state.
It then matches the generated state roots with the state root provided in the block. If it succeeds the generated state becomes the current state so the next block will be applied on this state. 
Once the block passes the verification step, Vulcan will emit a `C2` confirmation event to the corresponding MRU and send the block to the `L1Submitter` module for settlement.

### zkWASM Integration

Stackr is also exploring the potential of zkWASM-based verification, enabling Vulcan to execute application WASM binaries within a zkVM and generate STARK proofs.
These proofs can be aggregated into a single STARK proof and wrapped in a groth16 wrapper for final verification on the parent chain. 
Proof aggregation will amortize the cost of verifying multiple blocks in a single proof, leading to a more efficient verification process.
It will also enable highly secure and scalable settlement of multiple blocks in a single proof.

## Fast finality

Since the Vulcan layer is responsible for checking the correctness of actions, it can also provide a confirmation before the data hits the parent chain. 
As mentioned previously, Stackr’s Micro-rollups provide multiple levels of confirmations, which can be used for building different user experiences. 
Vulcan behaves like a fast finality settlement layer, providing soft confirmations orders of magnitude faster than the underlying parent chain and DA layer.

## Settlement

Once an incoming batch is verified, Vulcan will first ensure its availability by posting it to a DA layer of the developer's choice. This can be Avail, Celestia or EigenDA.
After finalizing proof of data publication, Vulcan will emit a `C3A` confirmation event to denote guaranteed data availability and then proceed submit the batch to the corresponding MRU's `AppInbox` smart contract on the parent chain. 
On successful submission, the batch will be appended to the canonical chain on L1 and Vulcan will emit a `C3B` confirmation event denoting the settlement of the batch onchain. 


